<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>UnicornsRHardcore2</title>
  <style>
    body {
      font-family: monospace;
      background-color: #1e1e1e;
      color: #f0f0f0;
      padding: 15px;
    }
    #title{
      width: 50%;
      height: auto;
      margin-bottom: 8px;
      display: block;
    }
    #output {
      display: flex;
      height: 55vh;
      min-height: 300px;
      max-height: 900px;
      margin-bottom: 10px;
    }
    .outputWindow{
      background: #2b2b2b;
      width: 70%;
      height: 100%;
      padding-left: 10px;
      scroll-padding: 10px;
      overflow-y: auto;
      border: 1px solid #444;
      margin-right: 10px;
      margin-bottom: 10px;
      white-space: pre-wrap;
    }
    .outputMap {
      width: 30%;
      height: 100%;
      border: 1px solid #444;
      white-space: pre-wrap;
      margin-bottom: 10px;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #menu{
      display: none;
      gap: 10px;
    }
    .menuItem {
      width: fit-content;
      padding: 8px;
      margin-bottom: 10px;
      border: 1px solid #444;
      font-family: monospace;
      font-size: 1em;
      background-color: #333;
      color: #fff;
    }
    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    .fade-in {
      animation: fadeIn 5s ease-out forwards;
    }
    #nameInput, #command {
      width: 99%;
      padding: 10px;
      border: none;
      font-family: monospace;
      font-size: 1em;
      background-color: #333;
      color: #fff;
      margin-bottom: 10px;
    }
    #footer{
      position: fixed;
      bottom: 15px;
      left: 15px;
      right: 15px;
      height: 180px;
      margin: 0 auto; /* ✅ This centers it horizontally */
      padding: 3px;
      border: 1px solid #444;
      background-image: url("images/nightskyascii.png");
      background-position: center; /* Centers the image */
      background-size: cover; 
      background-repeat: no-repeat; /* Prevents tiling */
      z-index: 10;
    }
    #gameover {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-image: url("images/nightskyascii.png");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      color: #ff6b6b;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      font-family: monospace;
    }
    
    #gameover pre {
      text-align: center;
      font-size: 1.2em;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
      animation: fadeIn 5s ease-out forwards;
    }
    
    #gameover .reload-hint {
      margin-top: 20px;
      font-size: 1em;
      color: #ffd93d;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
    }
  </style>
</head>
<body>
  <!--<img id="title" img src="/images/titleascii.png" alt="Game Logo">-->
  <div id="output">
    <div class="outputWindow">
    This is your first step into a strange adventure.
    What is your name?
  </div>
    <div class="outputMap">???</div>
  </div>

  <div id="menu">
    <div class="menuItem">north</div>
    <div class="menuItem">south</div>
    <div class="menuItem">east</div>
    <div class="menuItem">west</div>
    <div class="menuItem">inspect</div>
    <div class="menuItem">inventory</div>
    <div class="menuItem">inspect [itemName]</div>
    <div class="menuItem">give [itemName]</div>
    <div class="menuItem">talk [npcName]</div>
    <div class="menuItem">attack [npcName]</div>
  </div>

  <input type="text" id="nameInput" placeholder="Enter your name" autofocus />
  <input type="text" id="command" placeholder="Enter your command" style="display:none;" />

<div id="footer">
  <pre>
     .   ____          _            __ _ _
    /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
   ( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
    \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
     '  |____| .__|_| |_|_| |_\__, | / / / /
    =========|_|==============|___/=/_/_/_/
    :: Spring Boot ::                (v3.2.5)

    :: Alba Pläp Golfe ::
    :: 2025 ::
  </pre>
</div>

<div id="gameover">
  <pre>
 _______ _______ _______ _______      _______ ___ ___ _______ ______ 
|     __|   _   |   |   |    ___|    |       |   |   |    ___|   __ \
|    |  |       |       |    ___|    |   -   |   |   |    ___|      <
|_______|___|___|__|_|__|_______|    |_______|\\\___/|_______|___|\_|

    Your adventure ends here...
    
    :: Spring Boot ::                (v3.2.5)
    :: Alba Pläp Golfe ::
    :: 2025 ::
  </pre>
  <div class="reload-hint">Reload website to play again!</div>
</div>

  <script>
    const output = document.querySelector('.outputWindow');
    const outputMap = document.querySelector('.outputMap');
    const nameInput = document.getElementById('nameInput');
    const commandInput = document.getElementById('command');
    
    function showGameOver() {
      document.getElementById('gameover').style.display = 'flex';
      commandInput.disabled = true;
      commandInput.style.display = 'none';
      document.getElementById('menu').style.display = 'none';
    }

    nameInput.addEventListener('keydown', async function (e) {
      if (e.key === 'Enter') {
        const name = nameInput.value.trim();
        if (!name) return;

        output.textContent += `\n> ${name}`;
        nameInput.style.display = 'none';
        commandInput.style.display = 'block';
        const menu = document.getElementById('menu');
        menu.style.display= 'flex';
        menu.classList.add('fade-in');
        commandInput.focus();

        const res = await fetch('http://localhost:8080/start', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(name)
        });

        const introText = await res.text();
        output.textContent += `\n${introText}`;
        output.scrollTop = output.scrollHeight;
      }
    });

    commandInput.addEventListener('keydown', function (e) {
      if (e.key === 'Enter') {
      const command = commandInput.value;
      commandInput.value = '';
      output.textContent += `\n> ${command}`;
      output.scrollTop = output.scrollHeight;

      // ✅ Send to backend
      fetch('http://localhost:8080/command', {
        method: 'POST',
        headers: {
          'Content-Type': 'text/plain'
        },
        body: command
      })
      .then(response => response.text())
      .then(data => {
        output.textContent += `\n${data}`;
        output.scrollTop = output.scrollHeight;
        
        // Check if player died (game over)
        if (data.includes("GAME OVER")) {
          showGameOver();
          return;
        }

      fetch('http://localhost:8080/map', {
        method: 'POST'
      })
      .then(response => response.text())
      .then(mapBackground => {
        if (mapBackground.startsWith("#")) {
          outputMap.style.background = mapBackground;
          outputMap.textContent = "???";
        } else {
          outputMap.style.background = `url(${mapBackground})`;
          outputMap.style.backgroundSize = "cover";
          outputMap.style.backgroundPosition = "center";
          outputMap.textContent = ""; // remove ??? text
          }
        });
      })

      .catch(error => {
        output.textContent += `\n[Error communicating with server]`;
      });
    }
  });
  </script>
</body>
</html>